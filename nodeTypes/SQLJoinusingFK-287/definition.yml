fileVersion: 1
id: "287"
isDisabled: false
metadata:
  defaultStorageLocation: STAGE
  error: null
  nodeMetadataSpec: |
    capitalized: SQL JOIN
    short: V
    plural: Joins
    tagColor: '#2EB67D'

    joinTemplate: |
      {%- set node_list = [] %}
      {%- for fk in parameters.fkeys | sort(attribute = 'order') %} 
        {%- for dep in sources[0].dependencies %}  
          {%- if fk.table == dep.node.name %} 
            {{- node_list.append(dep.node.name) or "" }}
          {%- endif %}
        {%- endfor %}
      {%- endfor %}
      {% for dep in node_list | unique %}
        {%- if loop.first %} FROM {%- else %} {%- if config.toggleLeft %} LEFT {%- endif %} JOIN {%- endif %}
        {{ ref_raw("SRC_SAMPLE",dep) }} "{{ dep }}"
        {%- if not loop.first %}
          {%- for fk in parameters.fkeys if fk.table == dep and fk.fktable in node_list %}
              {%- if loop.first %} ON {%- else %} AND {%- endif %} 
              "{{ fk.fktable }}"."{{ fk.fk }}" = "{{ dep }}"."{{ fk.pk }}"
          {%- endfor %}
        {%- endif %}
      {% endfor %}

    config:
    - groupName: Options

      items:
      - type: materializationSelector
        default: view
        options:
        - view
        isRequired: true
        enableIf: "false"

      - type: toggleButton
        displayName: Edit Join Clause
        attributeName: toggleWhere 
        default: false

      - type: toggleButton
        displayName: Left Joins
        attributeName: toggleLeft 
        default: false
name: SQL Join using FK
type: NodeType
