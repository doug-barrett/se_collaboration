steps:
  VW_FORECAST_WEEK-148400f3-984c-4ee0-9880-dc4f6865d529:
    operation:
      config:
        insertStrategy: UNION
        selectDistinct: false
      database: ""
      deployEnabled: true
      description: ""
      isMultisource: false
      locationName: STAGE
      materializationType: view
      metadata:
        appliedNodeTests: []
        columns:
          - columnReference:
              columnCounter: 654a60eb-e2c2-447a-83e7-ab2120d97202
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: NUMBER(38,0)
            description: ""
            hashColumns: []
            hashDetails: null
            name: DIM_FORECAST_KEY
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 31d76e7d-bf56-46bb-b0be-2b6864299451
                    stepCounter: 069788a4-dc62-406e-839f-961e1e66904e
                transform: ""
          - columnReference:
              columnCounter: 10d434b7-75d0-452a-8a4f-ddbbe2357545
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: VARCHAR(16777216)
            description: ""
            name: ZONE_GEOGRAPHY
            nullable: false
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 49fa4aa2-0fd7-41d8-acce-b7761001db7f
                    stepCounter: 069788a4-dc62-406e-839f-961e1e66904e
                transform: ""
          - columnReference:
              columnCounter: c6b79b64-4342-46f8-b4ef-74566e0fc944
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: VARCHAR(6)
            description: ""
            name: PRODKEY
            nullable: false
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: e6f8b289-0941-479b-a4a0-5edf304bce26
                    stepCounter: 069788a4-dc62-406e-839f-961e1e66904e
                transform: ""
          - columnReference:
              columnCounter: 27b168e1-1769-41f3-865a-6dcb7ffd7ff9
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: VARCHAR(50)
            description: ""
            name: LEVEL1_DESC
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 48a82910-6386-46e0-b072-3c89965cb3c1
                    stepCounter: 99510b9e-1d3e-4709-93b8-2042202093b0
                transform: ""
          - columnReference:
              columnCounter: f3d2ed91-a076-43d4-95f2-eb5260be5e38
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: VARCHAR(50)
            description: ""
            name: LEVEL2_DESC
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 850983c0-90a9-4640-84e8-e8ae587b9e5a
                    stepCounter: 99510b9e-1d3e-4709-93b8-2042202093b0
                transform: ""
          - columnReference:
              columnCounter: e979a6aa-b188-402f-a1a7-8bc6880e8f10
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: VARCHAR(50)
            description: ""
            name: LEVEL3_DESC
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 76b80dd0-990c-439c-9b2a-f320fd772670
                    stepCounter: 99510b9e-1d3e-4709-93b8-2042202093b0
                transform: ""
          - columnReference:
              columnCounter: e5ea8e16-57ff-4315-82cc-609d9b4f3503
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: VARCHAR(10)
            description: ""
            name: FINANCIAL_YEAR
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: e887d4bb-0af2-43e9-aa0d-88a956916bf4
                    stepCounter: 732ca70b-49a5-4fd4-bff5-a4f8b0b0866e
                transform: ""
          - columnReference:
              columnCounter: 22d78006-8e54-437d-b1ed-65d66f3a08aa
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: NUMBER(38,0)
            description: ""
            name: FINANCIAL_WEEK
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 38305394-9863-4863-800a-78ef9a1fba5f
                    stepCounter: 732ca70b-49a5-4fd4-bff5-a4f8b0b0866e
                transform: ""
          - columnReference:
              columnCounter: 9506268d-9f8e-4edb-9ee9-5034103c1d67
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: VARCHAR(10)
            description: ""
            name: FINANCIAL_YYWW
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 01fb2238-8dfe-4fee-9c2d-3135d47bbf5c
                    stepCounter: 732ca70b-49a5-4fd4-bff5-a4f8b0b0866e
                transform: ""
          - columnReference:
              columnCounter: eec4d75a-0b87-4528-a8c9-98bf8bf50ee4
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: VARCHAR(64)
            description: ""
            name: HOLIDAY_NAME
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 9f493084-a806-46ea-a120-a4cad2741e62
                    stepCounter: 732ca70b-49a5-4fd4-bff5-a4f8b0b0866e
                transform: ""
          - columnReference:
              columnCounter: 90ec2f82-8e87-42ec-81f9-77f2694f3e77
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: DATE
            description: ""
            name: HOLIDAY_DATE
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 0baaea5d-da84-45ee-9f57-c7baf2e547f9
                    stepCounter: 732ca70b-49a5-4fd4-bff5-a4f8b0b0866e
                transform: ""
          - columnReference:
              columnCounter: 6b10d6cd-41ab-4081-97ca-ea418ee97a1b
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: NUMBER
            description: ""
            name: HOLIDAY_WEEK_RELATIVE
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 1a3851eb-4518-44a9-8eed-b0e75607a175
                    stepCounter: 732ca70b-49a5-4fd4-bff5-a4f8b0b0866e
                transform: ""
          - columnReference:
              columnCounter: cb42875a-ed65-4f5a-9f01-58990d6a0408
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: NUMBER
            description: ""
            name: DAYS_IN_WEEK
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 01fb2238-8dfe-4fee-9c2d-3135d47bbf5c
                    stepCounter: 732ca70b-49a5-4fd4-bff5-a4f8b0b0866e
                transform: |-
                  CASE WHEN "PROMO_PLAN"."EFFECTIVE_DATE" BETWEEN "VW_DATE_FIN_WEEK"."MIN_DATE" AND "VW_DATE_FIN_WEEK"."MAX_DATE"
                        AND "PROMO_PLAN"."END_DATE" BETWEEN "VW_DATE_FIN_WEEK"."MIN_DATE" AND "VW_DATE_FIN_WEEK"."MAX_DATE"
                        AND "PROMO_PLAN"."DURATION" < 7
                      THEN "PROMO_PLAN"."DURATION"
                      WHEN "PROMO_PLAN"."EFFECTIVE_DATE" BETWEEN "VW_DATE_FIN_WEEK"."MIN_DATE" AND "VW_DATE_FIN_WEEK"."MAX_DATE"
                        AND "PROMO_PLAN"."END_DATE" > "VW_DATE_FIN_WEEK"."MAX_DATE"
                      THEN DATEDIFF(DAY, "PROMO_PLAN"."EFFECTIVE_DATE", "VW_DATE_FIN_WEEK"."MAX_DATE") + 1
                      WHEN "PROMO_PLAN"."END_DATE" BETWEEN "VW_DATE_FIN_WEEK"."MIN_DATE" AND "VW_DATE_FIN_WEEK"."MAX_DATE"
                        AND "PROMO_PLAN"."EFFECTIVE_DATE" < "VW_DATE_FIN_WEEK"."MIN_DATE"
                      THEN DATEDIFF(DAY, "VW_DATE_FIN_WEEK".MIN_DATE, "PROMO_PLAN"."END_DATE") + 1
                      ELSE 7
                  END
          - columnReference:
              columnCounter: 7c70a0f1-b52a-4435-9f32-a4f491947c15
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: NUMBER(5,3)
            description: ""
            name: WEEK_RATIO
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 01fb2238-8dfe-4fee-9c2d-3135d47bbf5c
                    stepCounter: 732ca70b-49a5-4fd4-bff5-a4f8b0b0866e
                transform: DAYS_IN_WEEK / "PROMO_PLAN"."DURATION"
          - columnReference:
              columnCounter: bb5c544d-bf8a-4bd8-ba7d-aa7c7a7a3475
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: VARCHAR(16777216)
            description: ""
            name: APPROVAL_STATUS
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 10faef69-69f4-41bb-b9bc-4d220b73e48c
                    stepCounter: 069788a4-dc62-406e-839f-961e1e66904e
                transform: ""
          - columnReference:
              columnCounter: a6d2864c-84ed-4553-a9c4-f1783e7c0503
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: VARCHAR(16777216)
            description: ""
            name: EVENT_TYPE
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: a3401032-f0bc-40aa-ae56-61cc29b75337
                    stepCounter: 069788a4-dc62-406e-839f-961e1e66904e
                transform: ""
          - columnReference:
              columnCounter: 4a24a29f-19be-4756-a9aa-10d0239cb9f4
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: DATE
            description: ""
            name: EFFECTIVE_DATE
            nullable: false
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: c6eb68e6-a502-44da-84d5-5d6ca04fc1e8
                    stepCounter: 069788a4-dc62-406e-839f-961e1e66904e
                transform: ""
          - columnReference:
              columnCounter: 96e38585-ad59-4d77-b061-cc62b1959ba3
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: DATE
            description: ""
            name: END_DATE
            nullable: false
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 409a56a2-df69-4f79-a4c7-548c60017aba
                    stepCounter: 069788a4-dc62-406e-839f-961e1e66904e
                transform: ""
          - columnReference:
              columnCounter: 8bee94cd-8133-4520-be28-baf463f5befb
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: NUMBER(38,0)
            description: ""
            name: DURATION
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 585480c3-bf0e-42cf-9c1a-fe24cddea898
                    stepCounter: 069788a4-dc62-406e-839f-961e1e66904e
                transform: ""
          - columnReference:
              columnCounter: 1fe1e45e-9c7c-4207-b068-e13fd0d5078f
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: NUMBER(12,2)
            description: ""
            name: BASE_UNITS_PER_WEEK
            nullable: true
            sourceColumnReferences:
              - columnReferences: []
                transform: "\"PROMO_PLAN\".\"BASE_UNITS_PER_DAY\" * DAYS_IN_WEEK"
          - columnReference:
              columnCounter: 212bf7f2-f60c-47cb-970f-f6715d2465ad
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: NUMBER(12,2)
            description: ""
            name: UNITS_PER_WEEK
            nullable: true
            sourceColumnReferences:
              - columnReferences: []
                transform: "\"PROMO_PLAN\".\"UNITS_PER_DAY\" * DAYS_IN_WEEK"
          - columnReference:
              columnCounter: 5c8e1cf5-003c-4bf4-b84f-b1369812c3a9
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: NUMBER(12,2)
            description: ""
            name: UPLIFT_UNITS_PER_WEEK
            nullable: true
            sourceColumnReferences:
              - columnReferences: []
                transform: "\"PROMO_PLAN\".\"UPLIFT_UNITS_PER_DAY\" * DAYS_IN_WEEK"
          - columnReference:
              columnCounter: 27d8f86d-6949-4625-a538-f1ad44c3b6ac
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: VARCHAR(1)
            description: ""
            name: OPTIMIZED_VOLUME_FLAG
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 694fd7cf-03bd-42dc-a6c9-459414897c48
                    stepCounter: 069788a4-dc62-406e-839f-961e1e66904e
                transform: ""
          - columnReference:
              columnCounter: afa52205-3f04-46b9-840b-f18318aa3182
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: NUMBER(12,2)
            description: ""
            name: OPTIMIZED_UNITS_PER_WEEK
            nullable: true
            sourceColumnReferences:
              - columnReferences: []
                transform: "\"PROMO_PLAN\".\"OPTIMIZED_UNITS_PER_DAY\" * DAYS_IN_WEEK"
          - columnReference:
              columnCounter: 8b67ee17-0f92-40db-b9f9-bf4dcc185eb9
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: NUMBER(12,2)
            description: ""
            name: BASE_SALES_PER_WEEK
            nullable: true
            sourceColumnReferences:
              - columnReferences: []
                transform: "\"PROMO_PLAN\".\"BASE_UNITS_PER_DAY\" * \"PROMO_PLAN\".\"WAS_PRICE\" * DAYS_IN_WEEK"
          - columnReference:
              columnCounter: 8200411e-f51e-4508-8944-4876c7c37c69
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: NUMBER(12,2)
            description: ""
            name: SALES_PER_WEEK
            nullable: true
            sourceColumnReferences:
              - columnReferences: []
                transform: "\"PROMO_PLAN\".\"UNITS_PER_DAY\" * \"PROMO_PLAN\".\"NOW_PRICE\" * DAYS_IN_WEEK"
          - columnReference:
              columnCounter: 242bd37c-f018-4a59-ad2b-5f8267c9b037
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: NUMBER(12,2)
            description: ""
            name: UPLIFT_SALES_PER_WEEK
            nullable: true
            sourceColumnReferences:
              - columnReferences: []
                transform: SALES_PER_WEEK - BASE_SALES_PER_WEEK
          - columnReference:
              columnCounter: c5405729-e75a-482b-a77f-93a689ad70f5
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: NUMBER(12,2)
            description: ""
            name: BASE_MARGIN_PER_WEEK
            nullable: true
            sourceColumnReferences:
              - columnReferences: []
                transform: "\"PROMO_PLAN\".\"BASE_UNITS_PER_DAY\" * \"PROMO_PLAN\".BASE_MARGIN_PER_UNIT * DAYS_IN_WEEK"
          - columnReference:
              columnCounter: e9978f3f-c515-4a91-a6b2-ce265811d273
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: NUMBER(12,2)
            description: ""
            name: SOA_2_PER_UNIT
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 7a81fc74-e511-4dc6-a4d1-44cf8f991beb
                    stepCounter: 069788a4-dc62-406e-839f-961e1e66904e
                transform: ""
          - columnReference:
              columnCounter: 9430ae8c-40b6-4cd8-b9dd-5db4c7f5b169
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: NUMBER(12,2)
            description: ""
            name: SOA_2_PER_WEEK
            nullable: true
            sourceColumnReferences:
              - columnReferences:
                  - columnCounter: 7a81fc74-e511-4dc6-a4d1-44cf8f991beb
                    stepCounter: 069788a4-dc62-406e-839f-961e1e66904e
                transform: "\"PROMO_PLAN\".\"SOA_2_PER_UNIT\" * UNITS_PER_WEEK"
          - columnReference:
              columnCounter: 218f55ba-266f-4558-ac14-796277c36a23
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: NUMBER(12,2)
            description: ""
            name: MARGIN_PER_WEEK
            nullable: true
            sourceColumnReferences:
              - columnReferences: []
                transform: "\"PROMO_PLAN\".\"UNITS_PER_DAY\" * \"PROMO_PLAN\".\"MARGIN_PER_UNIT\" * DAYS_IN_WEEK"
          - columnReference:
              columnCounter: 8a3f11ce-8f08-45cd-8eb7-8f1995d9299a
              stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
            dataType: NUMBER(12,2)
            description: ""
            name: UPLIFT_MARGIN_PER_WEEK
            nullable: true
            sourceColumnReferences:
              - columnReferences: []
                transform: MARGIN_PER_WEEK - BASE_MARGIN_PER_WEEK
        cteString: ""
        enabledColumnTestIDs: []
        sourceMapping:
          - aliases:
              DIM_PRODUCT: 99510b9e-1d3e-4709-93b8-2042202093b0
              PROMO_PLAN: 069788a4-dc62-406e-839f-961e1e66904e
              VW_DATE_FIN_WEEK: 732ca70b-49a5-4fd4-bff5-a4f8b0b0866e
            customSQL:
              customSQL: ""
            dependencies:
              - locationName: DATA
                nodeName: DIM_PRODUCT
              - locationName: INPUT
                nodeName: PROMO_PLAN
              - locationName: STAGE
                nodeName: VW_DATE_FIN_WEEK
            join:
              joinCondition: |
                FROM {{ ref('INPUT', 'PROMO_PLAN')}} "PROMO_PLAN"
                JOIN {{ ref('STAGE', 'VW_DATE_FIN_WEEK') }} "VW_DATE_FIN_WEEK"
                ON "PROMO_PLAN"."EFFECTIVE_DATE" BETWEEN "VW_DATE_FIN_WEEK"."MIN_DATE" AND "VW_DATE_FIN_WEEK"."MAX_DATE"
                OR "PROMO_PLAN"."END_DATE" BETWEEN "VW_DATE_FIN_WEEK"."MIN_DATE" AND "VW_DATE_FIN_WEEK"."MAX_DATE"
                OR "VW_DATE_FIN_WEEK"."MIN_DATE" BETWEEN "PROMO_PLAN"."EFFECTIVE_DATE" AND "PROMO_PLAN"."END_DATE"
                JOIN {{ ref('DATA', 'DIM_PRODUCT') }} "DIM_PRODUCT"
                ON "PROMO_PLAN"."PRODKEY" = "DIM_PRODUCT"."PRODKEY"
                QUALIFY 1 = ROW_NUMBER() OVER (PARTITION BY "VW_DATE_FIN_WEEK"."FINANCIAL_YYWW", "PROMO_PLAN"."ZONE_GEOGRAPHY", "PROMO_PLAN"."PRODKEY" ORDER BY "PROMO_PLAN"."DIM_FORECAST_KEY" DESC)
            name: VW_FORECAST_WEEK
            noLinkRefs: []
      name: VW_FORECAST_WEEK
      overrideSQL: false
      schema: ""
      sqlType: "16"
      type: sql
    stepCounter: 148400f3-984c-4ee0-9880-dc4f6865d529
