fileVersion: 1
id: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
name: TMP_ENGAGEMENT_TEMP
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT_HL
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2ae10ab8-4d91-4c45-85d2-4ca40161fb56
          stepCounter: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ENGAGEMENT_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 7c4faf43-32d5-4695-8908-7b10df95581d
          stepCounter: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ENGAGEMENT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 79043699-898f-43a3-8b85-9d462fa55ef1
          stepCounter: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ENG_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 20ae6d26-e8bf-4c23-a834-9655c8c77646
          stepCounter: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ENG_LINE_OF_BUSINESS
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4858a7f9-be2b-4359-a240-0ff0a61476e1
          stepCounter: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ENG_CLIENT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4f5a82cb-8dbf-4094-88da-e2247c0f506a
          stepCounter: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ENG_CLIENT_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 65139bca-5636-42d2-bab6-ccea5a700170
          stepCounter: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ENG_SUBJECT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 12915f0a-243f-4b68-af7f-ec491b3e3704
          stepCounter: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ENG_SUBJECT_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dde837dd-d088-4168-84ae-b9967ba7f373
          stepCounter: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
        config: {}
        dataType: DATE
        description: ""
        hashDetails: null
        name: ENG_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cca9e160-5ed8-4ead-a47a-d4beee6a551d
          stepCounter: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: CF_JOB_TYPE2
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 415a949a-dac4-4967-8fd8-6f8b0702d94e
          stepCounter: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ENG_STATUS
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6981f570-d1f2-4e35-84f7-23569353f6e5
          stepCounter: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ENG_STAGE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bc804a94-4466-4e4a-9e65-b2a014e53fc6
          stepCounter: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
        config: {}
        dataType: DATE
        description: ""
        hashDetails: null
        name: ENG_CLOSE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f0cdb138-53a9-4a1b-8888-6f7d764b930c
          stepCounter: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ENG_CURRENCY
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f924ffd4-a96e-477a-b52e-c9cc18efa369
          stepCounter: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        hashDetails: null
        name: ENG_TRANSACTION_SIZE_MM_USD
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8a53fe80-3a2a-426e-a8a3-3879913213e1
          stepCounter: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
        config: {}
        dataType: NUMBER(38,6)
        description: ""
        hashDetails: null
        name: TOTAL_FEE_MUSD
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 27f8d8cc-dada-4f09-b7b7-b367f32a40d5
          stepCounter: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
        config: {}
        dataType: DATE
        description: ""
        hashDetails: null
        name: ENG_ESTIMATED_CLOSE_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3e077483-738d-4318-8c9b-1dd9a03c57e6
          stepCounter: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ENG_STAFF_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e4951913-b459-4c29-86b5-ae4d96442546
          stepCounter: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: COVERAGE_OFFICER_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 77ced2d4-e940-4b86-918e-3d3651321c60
          stepCounter: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: COVERAGE_OFFICER_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0011e3b3-643d-4170-aae3-d9133bdf62ab
          stepCounter: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: COMPANY_TIER
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dc5c634f-a318-4fe3-9bc9-4a45c5d82802
          stepCounter: 4f0a20e3-58dc-4a0d-a57f-d12c044811ef
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: DND_STATUS
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('Override Create SQL') }}
            	CREATE OR REPLACE VIEW {{ ref('TGT_HL', 'TMP_ENGAGEMENT_TEMP')}} AS (
                SELECT DISTINCT ENGAGEMENT__C.ENGAGEMENT_NUMBER_C AS ENGAGEMENT_NUMBER
                    ,ENGAGEMENT__C.FULL_ENGAGEMENT_ID_C AS ENGAGEMENT_ID
                    ,ENGAGEMENT__C.NAME AS ENG_NAME
                    ,ENGAGEMENT__C.LINE_OF_BUSINESS_C AS ENG_LINE_OF_BUSINESS
                    ,ENGAGEMENT__C.CLIENT_C AS ENG_Client_ID
                    ,CLIENT.NAME AS ENG_Client_Name
                    ,ENGAGEMENT__C.SUBJECT_C AS ENG_Subject_ID
                    ,ENGAGEMENT__C.ORIGINAL_SUBJECT_NAME_C AS ENG_Subject_Name
                    ,ENGAGEMENT__C.DATE_ENGAGED_C AS ENG_Date
                    ,ENGAGEMENT__C.JOB_TYPE_C AS CF_Job_Type2
                    ,ENGAGEMENT__C.STATUS_C AS ENG_STATUS
                    ,ENGAGEMENT__C.STAGE_C AS ENG_STAGE
                    ,ENGAGEMENT__C.CLOSE_DATE_C AS ENG_Close_Date
                    ,ENGAGEMENT__C.CURRENCY_ISO_CODE AS ENG_Currency
                    ,ENGAGEMENT__C.EST_TRANSACTION_SIZE_MM_C AS ENG_Transaction_Size_MM_USD
                    ,ENGAGEMENT__C.TOTAL_FEE_C / 1000000 AS Total_Fee_MUSD
                    ,ENGAGEMENT__C.ESTIMATED_CLOSE_DATE_C AS ENG_Estimated_Close_Date
                    ,ENGAGEMENT_INTERNAL_TEAM__C.CONTACT_C AS ENG_Staff_ID
                    ,COVERAGE_ENGAGEMENT.Coverage_Officer_ID AS Coverage_Officer_ID
                    ,COVERAGE_ENGAGEMENT.Coverage_Officer_Name AS Coverage_Officer_Name
                    ,CONCAT (
                        COVERAGE_ENGAGEMENT.Company_TIER
                        ,'\\\\\\\\n'
                        ,'('
                        ,COVERAGE_ENGAGEMENT.COVERAGE_TEAM_STATUS
                        ,')'
                        ) AS Company_TIER
                    ,ENGAGEMENT__C.DND_STATUS_C AS DND_STATUS
                    FROM {{ref('TGT_HL','VW_ENGAGEMENT_C')}} AS ENGAGEMENT__C  
                    INNER JOIN {{ref('TGT_HL','VW_ACCOUNT')}} AS CLIENT ON ENGAGEMENT__C.CLIENT_C = CLIENT.ID
                    INNER JOIN {{ref('TGT_HL','VW_ENGAGEMENT_INTERNAL_TEAM_C')}} AS ENGAGEMENT_INTERNAL_TEAM__C 
                    ON ENGAGEMENT__C.ENGAGEMENT_NUMBER_C = ENGAGEMENT_INTERNAL_TEAM__C.ENGAGEMENT_NUMBER_C
                    INNER JOIN {{ref('TGT_HL','TMP_COVERAGE_ENGAGEMENT')}} AS COVERAGE_ENGAGEMENT ON (
                        ENGAGEMENT__C.CLIENT_C = COVERAGE_ENGAGEMENT.Company_ID
                        OR ENGAGEMENT__C.SUBJECT_C = COVERAGE_ENGAGEMENT.Company_ID
                        )
                    WHERE UPPER(ENGAGEMENT__C.LINE_OF_BUSINESS_C) IN (
                        'CF'
                        ,'FR'
                        )
                    AND (
                        (
                            UPPER(ENGAGEMENT__C.STATUS_C) = UPPER('Closed')
                            AND ENGAGEMENT__C.CLOSE_DATE_C >= CASE 
                                WHEN MONTH(GETDATE()) >= 4
                                    THEN CONCAT (
                                            '04/01/'
                                            ,LTRIM(YEAR(GETDATE()))
                                            )
                                ELSE CONCAT (
                                        '04/01/'
                                        ,LTRIM(YEAR(GETDATE()) - 1)
                                        )
                                END
                            AND ENGAGEMENT__C.CLOSE_DATE_C <= CASE 
                                WHEN MONTH(GETDATE()) >= 4
                                    THEN CONCAT (
                                            '03/31/'
                                            ,LTRIM(YEAR(GETDATE()) + 1)
                                            )
                                ELSE CONCAT (
                                        '03/31/'
                                        ,LTRIM(YEAR(GETDATE()))
                                        )
                                END
                            )
                        OR UPPER(ENGAGEMENT__C.STATUS_C) IN (
                            UPPER('Active')
                            ,UPPER('Hold')
                            )
                        )
                    AND UPPER(ENGAGEMENT_INTERNAL_TEAM__C.ROLE_C) IN (
                         UPPER('Initiator')
                        ,UPPER('Seller')
                        ,UPPER('Principal')
                        ,UPPER('Manager')
                        ,UPPER('Associate')
                        ,UPPER('Analyst')
                        )
            	)
        dependencies:
          - locationName: TGT_HL
            nodeName: TMP_COVERAGE_ENGAGEMENT
          - locationName: TGT_HL
            nodeName: VW_ACCOUNT
          - locationName: TGT_HL
            nodeName: VW_ENGAGEMENT_C
          - locationName: TGT_HL
            nodeName: VW_ENGAGEMENT_INTERNAL_TEAM_C
        join:
          joinCondition: |2-
                SELECT DISTINCT ENGAGEMENT__C.ENGAGEMENT_NUMBER_C AS ENGAGEMENT_NUMBER
                    ,ENGAGEMENT__C.FULL_ENGAGEMENT_ID_C AS ENGAGEMENT_ID
                    ,ENGAGEMENT__C.NAME AS ENG_NAME
                    ,ENGAGEMENT__C.LINE_OF_BUSINESS_C AS ENG_LINE_OF_BUSINESS
                    ,ENGAGEMENT__C.CLIENT_C AS ENG_Client_ID
                    ,CLIENT.NAME AS ENG_Client_Name
                    ,ENGAGEMENT__C.SUBJECT_C AS ENG_Subject_ID
                    ,ENGAGEMENT__C.ORIGINAL_SUBJECT_NAME_C AS ENG_Subject_Name
                    ,ENGAGEMENT__C.DATE_ENGAGED_C AS ENG_Date
                    ,ENGAGEMENT__C.JOB_TYPE_C AS CF_Job_Type2
                    ,ENGAGEMENT__C.STATUS_C AS ENG_STATUS
                    ,ENGAGEMENT__C.STAGE_C AS ENG_STAGE
                    ,ENGAGEMENT__C.CLOSE_DATE_C AS ENG_Close_Date
                    ,ENGAGEMENT__C.CURRENCY_ISO_CODE AS ENG_Currency
                    ,ENGAGEMENT__C.EST_TRANSACTION_SIZE_MM_C AS ENG_Transaction_Size_MM_USD
                    ,ENGAGEMENT__C.TOTAL_FEE_C / 1000000 AS Total_Fee_MUSD
                    ,ENGAGEMENT__C.ESTIMATED_CLOSE_DATE_C AS ENG_Estimated_Close_Date
                    ,ENGAGEMENT_INTERNAL_TEAM__C.CONTACT_C AS ENG_Staff_ID
                    ,COVERAGE_ENGAGEMENT.Coverage_Officer_ID AS Coverage_Officer_ID
                    ,COVERAGE_ENGAGEMENT.Coverage_Officer_Name AS Coverage_Officer_Name
                    ,CONCAT (
                        COVERAGE_ENGAGEMENT.Company_TIER
                        ,'\\\\\\\\n'
                        ,'('
                        ,COVERAGE_ENGAGEMENT.COVERAGE_TEAM_STATUS
                        ,')'
                        ) AS Company_TIER
                    ,ENGAGEMENT__C.DND_STATUS_C AS DND_STATUS
                    FROM {{ref('TGT_HL','VW_ENGAGEMENT_C')}} AS ENGAGEMENT__C  
                    INNER JOIN {{ref('TGT_HL','VW_ACCOUNT')}} AS CLIENT ON ENGAGEMENT__C.CLIENT_C = CLIENT.ID
                    INNER JOIN {{ref('TGT_HL','VW_ENGAGEMENT_INTERNAL_TEAM_C')}} AS ENGAGEMENT_INTERNAL_TEAM__C 
                    ON ENGAGEMENT__C.ENGAGEMENT_NUMBER_C = ENGAGEMENT_INTERNAL_TEAM__C.ENGAGEMENT_NUMBER_C
                    INNER JOIN {{ref('TGT_HL','TMP_COVERAGE_ENGAGEMENT')}} AS COVERAGE_ENGAGEMENT ON (
                        ENGAGEMENT__C.CLIENT_C = COVERAGE_ENGAGEMENT.Company_ID
                        OR ENGAGEMENT__C.SUBJECT_C = COVERAGE_ENGAGEMENT.Company_ID
                        )
                    WHERE UPPER(ENGAGEMENT__C.LINE_OF_BUSINESS_C) IN (
                        'CF'
                        ,'FR'
                        )
                    AND (
                        (
                            UPPER(ENGAGEMENT__C.STATUS_C) = UPPER('Closed')
                            AND ENGAGEMENT__C.CLOSE_DATE_C >= CASE 
                                WHEN MONTH(GETDATE()) >= 4
                                    THEN CONCAT (
                                            '04/01/'
                                            ,LTRIM(YEAR(GETDATE()))
                                            )
                                ELSE CONCAT (
                                        '04/01/'
                                        ,LTRIM(YEAR(GETDATE()) - 1)
                                        )
                                END
                            AND ENGAGEMENT__C.CLOSE_DATE_C <= CASE 
                                WHEN MONTH(GETDATE()) >= 4
                                    THEN CONCAT (
                                            '03/31/'
                                            ,LTRIM(YEAR(GETDATE()) + 1)
                                            )
                                ELSE CONCAT (
                                        '03/31/'
                                        ,LTRIM(YEAR(GETDATE()))
                                        )
                                END
                            )
                        OR UPPER(ENGAGEMENT__C.STATUS_C) IN (
                            UPPER('Active')
                            ,UPPER('Hold')
                            )
                        )
                    AND UPPER(ENGAGEMENT_INTERNAL_TEAM__C.ROLE_C) IN (
                         UPPER('Initiator')
                        ,UPPER('Seller')
                        ,UPPER('Principal')
                        ,UPPER('Manager')
                        ,UPPER('Associate')
                        ,UPPER('Analyst')
                        )
        name: TMP_ENGAGEMENT_TEMP
        noLinkRefs: []
  name: TMP_ENGAGEMENT_TEMP
  overrideSQL: true
  schema: ""
  sqlType: "154"
  type: sql
  version: 1
type: Node
