fileVersion: 1
id: 91c3542a-c2f9-472c-8706-d613acb63e06
name: FCT_SALES_DAY
operation:
  config:
    postSQL: ""
    preSQL: ""
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: UNITS_BASE updated on post sql of FCT_SALES_EVENT
  isMultisource: false
  locationName: DATA
  materializationType: table
  metadata:
    appliedNodeTests:
      - continueOnFailure: true
        description: ""
        name: Test UNITS against FCT_SALES
        runOrder: After
        templateString: |-
          SELECT 1 
          FROM (
              SELECT TRANSACTION_DATE, SUM(UNITS_NET) S_UNITS
              FROM {{ref('DATA', 'FCT_SALES')}}
              WHERE TRANSACTION_DATE BETWEEN CURRENT_DATE - 7 AND CURRENT_DATE
              GROUP BY 1) S
          LEFT JOIN (
              SELECT TRANSACTION_DATE, SUM(UNITS_NET) D_UNITS
              FROM {{this}}
              WHERE TRANSACTION_DATE BETWEEN CURRENT_DATE - 7 AND CURRENT_DATE
              GROUP BY 1) D
          ON D.TRANSACTION_DATE = S.TRANSACTION_DATE
          WHERE TO_NUMBER(D.D_UNITS) <> TO_NUMBER(S.S_UNITS)
          OR D.TRANSACTION_DATE IS NULL
    columns:
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: 53776bbd-937c-4506-a163-dedff0387a4a
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: DATE
        description: ""
        isBusinessKey: true
        name: TRANSACTION_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 48c8482e-22a0-495d-868c-6ae9dfab3324
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: bcede211-1839-4363-b6da-6fa314efe9ac
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: VARCHAR(64)
        description: ""
        isBusinessKey: true
        name: ZONE_GEOGRAPHY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7ab23ad6-5ac7-423d-af23-1a02d68241c5
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: 67539d7f-ec1f-4f62-95c0-e1a6e99796f7
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: VARCHAR(50)
        description: This is the product key
        isBusinessKey: true
        name: PRODKEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 93b7f080-67bc-451c-a01c-efdcabe7e7ca
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: 4c54afa0-aff4-4c0b-838e-de83363b4e2f
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: VARCHAR(10)
        description: ""
        name: FINANCIAL_YEAR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ea8dba65-9f1f-4ddc-b7fd-16cf4663a925
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - acceptedValues:
          strictMatch: false
          values: []
        appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: 9751f676-c42d-492f-97e7-7ca21a76ef42
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: INTEGER
        description: Generated artificial key
        name: DIM_EVENTS_REGION_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 850bb900-20b0-44d8-b0bd-216730600516
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: 84e5841c-0680-4354-919a-371297a57c95
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER
        description: ""
        name: DIM_PRICE_COST_KEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e6159ab3-bc34-4440-98ed-bf9736588858
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: 5d150ba2-db3a-4e0f-962a-44deec271577
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: DECIMAL(9,2)
        description: ""
        name: PRICE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1f5fa3bc-01f5-4084-9777-fb7e0a04ddaa
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: d5321bdd-f162-4b40-b842-aadfb7eccaaf
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: DECIMAL(9,2)
        description: ""
        name: BASE_PRICE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1f5fa3bc-01f5-4084-9777-fb7e0a04ddaa
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: fb185ff0-d38d-4d87-aeb8-9dcdb236b7b4
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: UNITS_BASE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bf631d8c-98c0-4379-a067-3df2d581f8b5
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: 0982f174-c543-4de4-a91e-3b6c4b01855f
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: UNITS_NET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bf631d8c-98c0-4379-a067-3df2d581f8b5
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: 5a5314a0-22d7-47f2-953b-a48bb7a28f99
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: UNITS_UPLIFT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bf631d8c-98c0-4379-a067-3df2d581f8b5
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: UNITS_NET - UNITS_BASE
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: fdd59e28-b1be-49ab-a9c6-f53f352998d3
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: UNITS_NET_YTD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bd99b6f3-b87c-4fca-ba2f-64e05a1b1343
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: 4af4a132-3536-425a-bc6e-8403e96095de
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: SALES_BASE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1cab1249-cbf6-404d-a2be-82dd6bada324
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: cac3e1c5-19b6-4097-a729-c4aa7ff08c40
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: SALES_NET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1cab1249-cbf6-404d-a2be-82dd6bada324
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: 169bd8e5-ce50-4955-a933-8edd0feba9e2
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: SALES_UPLIFT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1cab1249-cbf6-404d-a2be-82dd6bada324
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: SALES_NET - SALES_BASE
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: b22c41d4-6baa-4fa7-a7a8-b9311d172a1b
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: SALES_NET_YTD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0c6dc2b7-c5bb-471d-8088-d839b9b412e6
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: e7f48726-fdd3-41bd-a1b4-5b73ae192bfa
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: COST_TOTAL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1840fecc-f8ac-4650-bdd7-368c27345d4a
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: fcc4451a-9ec1-4c75-b342-52541997793a
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: MARGIN_BASE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 833dfab3-6e5c-419c-904b-574d7fac60a1
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: 107c4b55-1541-4898-ba87-3b66dc77ba43
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: MARGIN_NET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f68b1019-a569-4de4-90f4-f5d26fd50e1c
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: 40e369f0-435b-432d-9a2b-db2fea96b6d0
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: MARGIN_UPLIFT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 833dfab3-6e5c-419c-904b-574d7fac60a1
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: MARGIN_NET - MARGIN_BASE
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: 4ece78a1-8764-426f-b27f-a2378c9c3d84
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: MARGIN_NET_YTD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 25103043-c7af-4b8e-8037-068fba6efdcb
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: eba171b3-dfc6-4092-91fb-6499b6b8c6da
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: AVG_PRICE_ACTUAL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 21aa1d85-0987-489f-a83a-37aef0d6b594
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: ec4b6300-d31a-45a9-af17-6216ff023e51
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: UNITS_RETURNS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5f2864fb-0c31-417a-8c67-2f3b54c4fc85
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: 1820fabd-6601-408b-87cf-7222cfc72522
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: UNITS_SALES
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 27b93e09-9345-4a33-834e-15b8b08d4ba6
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: 5d246eff-76d0-42ec-9628-31a1ae97d236
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: SALES_TOTAL_SALES
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0164a7ac-168a-4c72-b219-b6a7344dd155
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: 388afc09-c74c-4b0f-b868-c1608cddad37
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: MARGIN_TOTAL_SALES
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 833dfab3-6e5c-419c-904b-574d7fac60a1
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: 9652b48e-ceb7-4143-9a1e-4fc539a58ea0
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: ACP_TOTAL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7402f9fa-462c-45bb-90d1-7e80796df3c3
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: e4a12932-a6b0-4c27-9e8a-cc548e3a3358
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: UBC_TOTAL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2cadada7-dd2a-4410-b684-94d278c2c162
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: 60a3f9cc-182a-4c32-bf0e-2166dc8634e2
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: SOA_TOTAL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d700002f-97ae-4194-9784-34b19c6981ee
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: 2b137310-626b-4f68-a63f-69358a63d32a
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: RETAILER_SOA_TOTAL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d8136efb-ccd9-4b76-8721-ebd707df07da
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: b0f9a066-ac9a-46d5-9020-1bcd09802a7e
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(16,2)
        description: ""
        name: TA_TOTAL
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 33aff6c4-164c-451e-ad2e-a87cd8696fdd
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - acceptedValues:
          strictMatch: false
          values: []
        appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: f0abfaad-64f3-4dce-8d0c-ad85b2bb1008
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: NUMBER(9,2)
        description: ""
        name: MARGIN_PERCENT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: df789181-ad7f-4857-ba0e-b8d6a55f7589
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
      - appliedColumnTests:
          hasNull: false
          isDistinct: false
        columnReference:
          columnCounter: 0fd99908-5cb5-445a-a1f1-cd14780b589c
          stepCounter: 91c3542a-c2f9-472c-8706-d613acb63e06
        config: {}
        dataType: VARCHAR(3)
        description: ""
        name: CURRENCY_CODE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: dd607f36-3b34-47c8-b435-0ca8012d90bc
                stepCounter: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
            transform: ""
    cteString: ""
    enabledColumnTestIDs:
      - hasNull
      - isDistinct
    sourceMapping:
      - aliases:
          VW_FCT_SALES_DAY: 46ef8c0c-b44c-4d5d-bdc1-1e15c88fbd7b
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: STAGE
            nodeName: VW_FCT_SALES_DAY
        join:
          joinCondition: FROM {{ ref('STAGE', 'VW_FCT_SALES_DAY') }}  "VW_FCT_SALES_DAY"
        name: FCT_SALES_DAY
        noLinkRefs: []
  name: FCT_SALES_DAY
  overrideSQL: false
  schema: ""
  sqlType: Fact
  type: sql
  version: 1
type: Node
