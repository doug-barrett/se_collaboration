fileVersion: 1
id: 717747c4-65ff-42d0-bab9-5c86d3fb43a5
name: VW_MEASURES_CURRENT_OPTIMIZE_2
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: STAGE
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8b273b00-cb9d-4260-80a3-41cef36f8f26
          stepCounter: 717747c4-65ff-42d0-bab9-5c86d3fb43a5
        config: {}
        dataType: VARCHAR(64)
        description: ""
        hashDetails: null
        name: ZONE_GEOGRAPHY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e0a7a1c7-df30-4499-be12-c1a77bdb2533
                stepCounter: 11ed50b4-e5c3-44b7-89fa-c539a604102d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 55120a13-e407-4bbf-b105-c4f175c2e15d
          stepCounter: 717747c4-65ff-42d0-bab9-5c86d3fb43a5
        config: {}
        dataType: VARCHAR(50)
        description: This is the product key
        hashDetails: null
        name: PRODKEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 43b93191-7d39-4389-b9d4-f80b6e2e3ca8
                stepCounter: 11ed50b4-e5c3-44b7-89fa-c539a604102d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5cbc403c-0e41-44d6-8da0-a9a4a0670783
          stepCounter: 717747c4-65ff-42d0-bab9-5c86d3fb43a5
        config: {}
        dataType: VARCHAR(50)
        description: ""
        hashDetails: null
        name: LEVEL3_DESC
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 85ba5ff7-3a73-4382-9896-c43765f454b5
                stepCounter: 11ed50b4-e5c3-44b7-89fa-c539a604102d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5754fef7-d418-465e-8fac-53bde14d980b
          stepCounter: 717747c4-65ff-42d0-bab9-5c86d3fb43a5
        config: {}
        dataType: VARCHAR(50)
        description: ""
        hashDetails: null
        name: BRAND
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7d4a4139-e163-4509-8930-c9bea667e5bb
                stepCounter: 11ed50b4-e5c3-44b7-89fa-c539a604102d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8c04cbe5-1d15-41f1-8e80-d27ac1e8c88f
          stepCounter: 717747c4-65ff-42d0-bab9-5c86d3fb43a5
        config: {}
        dataType: VARCHAR(64)
        description: ""
        hashDetails: null
        name: HOLIDAY_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8ee596eb-fa88-4934-b7d9-c7f814616d50
                stepCounter: 11ed50b4-e5c3-44b7-89fa-c539a604102d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 035e48e8-b39c-4912-93fd-7f2466b88b76
          stepCounter: 717747c4-65ff-42d0-bab9-5c86d3fb43a5
        config: {}
        dataType: VARCHAR(64)
        description: ""
        hashDetails: null
        name: DISCOUNT_BUCKET
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b64c68f1-eb97-4368-9a7e-73472d82d727
                stepCounter: 11ed50b4-e5c3-44b7-89fa-c539a604102d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e99cb12a-9d12-489b-b2ee-acd2303b008c
          stepCounter: 717747c4-65ff-42d0-bab9-5c86d3fb43a5
        config: {}
        dataType: DECIMAL(9,2)
        description: ""
        name: BASE_PRICE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cd41b8e4-7137-4323-bf73-290ee536c7ab
                stepCounter: 11ed50b4-e5c3-44b7-89fa-c539a604102d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cb010088-a79a-430c-a006-80d082c97ef6
          stepCounter: 717747c4-65ff-42d0-bab9-5c86d3fb43a5
        config: {}
        dataType: NUMBER(9,2)
        description: ""
        hashDetails: null
        name: BASE_UNITS_PER_DAY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 805f5cd4-1070-4e0a-9b6b-8c3e8472d120
                stepCounter: 11ed50b4-e5c3-44b7-89fa-c539a604102d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 94ae5757-ff85-41fc-8d45-9c5fcc91edfa
          stepCounter: 717747c4-65ff-42d0-bab9-5c86d3fb43a5
        config: {}
        dataType: STRING
        description: ""
        name: BASE_UNITS_PER_DAY_COMMENT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4dfeaebd-f9bf-44be-983f-396959b800aa
                stepCounter: 11ed50b4-e5c3-44b7-89fa-c539a604102d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cf3046fb-2185-494e-af78-b0c20f16fb44
          stepCounter: 717747c4-65ff-42d0-bab9-5c86d3fb43a5
        config: {}
        dataType: NUMBER(9,2)
        description: ""
        name: YEAR_MAX_UNITS_SALES_PER_DAY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: f69c5229-981d-4986-9f46-c292d1040a1c
                stepCounter: 11ed50b4-e5c3-44b7-89fa-c539a604102d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f2cdd87d-8d65-4be5-b52c-02dbba768a92
          stepCounter: 717747c4-65ff-42d0-bab9-5c86d3fb43a5
        config: {}
        dataType: NUMBER(6,4)
        description: ""
        name: PRICE_ELASTICITY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 71db3285-5a90-440c-9e10-474d0710523c
                stepCounter: 0ee506cb-6080-4f01-badd-887972fa7949
            transform: |-
              COALESCE(
                  zpdh.PRICE_ELASTICITY_PROD_HOL_DISC, 
                  zmbdh.PRICE_ELASTICITY_MA_BRAND_HOL_DISC, 
                  zmbd.PRICE_ELASTICITY_MA_BRAND_DISC, 
                  zmd.PRICE_ELASTICITY_MA_DISC, 
                  zm.PRICE_ELASTICITY_MA, 
                  2)
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 614f68b3-71bf-4131-ad03-ff574d3fbbf4
          stepCounter: 717747c4-65ff-42d0-bab9-5c86d3fb43a5
        config: {}
        dataType: STRING
        description: ""
        name: PRICE_ELASTICITY_COMMENT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 71db3285-5a90-440c-9e10-474d0710523c
                stepCounter: 0ee506cb-6080-4f01-badd-887972fa7949
            transform: |-
              CASE WHEN zpdh.PRICE_ELASTICITY_PROD_HOL_DISC IS NOT NULL THEN '1. PE from Zone, Prodkey, Discount, Holiday' 
                  WHEN zmbdh.PRICE_ELASTICITY_MA_BRAND_HOL_DISC IS NOT NULL THEN '2. PE from Zone, MA, Brand, Discount, Holiday'
                  WHEN zmbd.PRICE_ELASTICITY_MA_BRAND_DISC IS NOT NULL THEN '3. PE from Zone, MA, Brand, Discount' 
                  WHEN zmd.PRICE_ELASTICITY_MA_DISC IS NOT NULL THEN '4. PE from Zone, MA, Discount'
                  WHEN zm.PRICE_ELASTICITY_MA IS NOT NULL THEN '5. PE from Zone, MA'
              ELSE '6. PE Default of 2' 
              END
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          VW_MEASURES_CURRENT_OPTIMIZE_1: 11ed50b4-e5c3-44b7-89fa-c539a604102d
          zm: 0ee506cb-6080-4f01-badd-887972fa7949
          zmbd: 0ee506cb-6080-4f01-badd-887972fa7949
          zmbdh: 0ee506cb-6080-4f01-badd-887972fa7949
          zmd: 0ee506cb-6080-4f01-badd-887972fa7949
          zpdh: 0ee506cb-6080-4f01-badd-887972fa7949
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: DATA
            nodeName: FCT_PRICE_ELASTICITY
          - locationName: STAGE
            nodeName: VW_MEASURES_CURRENT_OPTIMIZE_1
        join:
          joinCondition: |-
            FROM {{ ref('STAGE', 'VW_MEASURES_CURRENT_OPTIMIZE_1') }} "VW_MEASURES_CURRENT_OPTIMIZE_1"
            LEFT JOIN {{ ref('DATA', 'FCT_PRICE_ELASTICITY') }} zpdh 
              ON VW_MEASURES_CURRENT_OPTIMIZE_1.zone_geography = zpdh.zone_geography 
              AND VW_MEASURES_CURRENT_OPTIMIZE_1.prodkey = zpdh.prodkey 
              AND VW_MEASURES_CURRENT_OPTIMIZE_1.discount_bucket = zpdh.discount_bucket 
              AND VW_MEASURES_CURRENT_OPTIMIZE_1.holiday_name = zpdh.holiday_name 
              AND zpdh.RN_PROD_HOL_DISC = 1
            LEFT JOIN {{ ref('DATA', 'FCT_PRICE_ELASTICITY') }} zmbdh 
              ON VW_MEASURES_CURRENT_OPTIMIZE_1.zone_geography = zmbdh.zone_geography 
              AND VW_MEASURES_CURRENT_OPTIMIZE_1.level3_desc = zmbdh.level3_desc 
              AND VW_MEASURES_CURRENT_OPTIMIZE_1.brand = zmbdh.brand 
              AND VW_MEASURES_CURRENT_OPTIMIZE_1.discount_bucket = zmbdh.discount_bucket 
              AND VW_MEASURES_CURRENT_OPTIMIZE_1.holiday_name = zmbdh.holiday_name 
              AND zmbdh.RN_MA_BRAND_HOL_DISC = 1 
              AND zpdh.prodkey IS NULL
            LEFT JOIN {{ ref('DATA', 'FCT_PRICE_ELASTICITY') }} zmbd 
              ON VW_MEASURES_CURRENT_OPTIMIZE_1.zone_geography = zmbd.zone_geography 
              AND VW_MEASURES_CURRENT_OPTIMIZE_1.level3_desc = zmbd.level3_desc 
              AND VW_MEASURES_CURRENT_OPTIMIZE_1.brand = zmbd.brand 
              AND VW_MEASURES_CURRENT_OPTIMIZE_1.discount_bucket = zmbd.discount_bucket 
              AND zmbd.RN_MA_BRAND_DISC = 1 
              AND zmbdh.level3_desc IS NULL
            LEFT JOIN {{ ref('DATA', 'FCT_PRICE_ELASTICITY') }} zmd 
              ON VW_MEASURES_CURRENT_OPTIMIZE_1.zone_geography = zmd.zone_geography 
              AND VW_MEASURES_CURRENT_OPTIMIZE_1.level3_desc = zmd.level3_desc 
              AND VW_MEASURES_CURRENT_OPTIMIZE_1.brand = zmd.brand 
              AND VW_MEASURES_CURRENT_OPTIMIZE_1.discount_bucket = zmd.discount_bucket 
              AND zmd.RN_MA_DISC = 1 
              AND zmbd.level3_desc IS NULL
            LEFT JOIN {{ ref('DATA', 'FCT_PRICE_ELASTICITY') }} zm
              ON VW_MEASURES_CURRENT_OPTIMIZE_1.zone_geography = zm.zone_geography 
              AND VW_MEASURES_CURRENT_OPTIMIZE_1.level3_desc = zm.level3_desc 
              AND VW_MEASURES_CURRENT_OPTIMIZE_1.brand = zm.brand 
              AND zm.RN_MA = 1 
              AND zmd.level3_desc IS NULL
        name: VW_MEASURES_CURRENT_OPTIMIZE_2
        noLinkRefs: []
  name: VW_MEASURES_CURRENT_OPTIMIZE_2
  overrideSQL: false
  schema: ""
  sqlType: "16"
  type: sql
  version: 1
type: Node
