fileVersion: 1
id: 72143244-e7c6-40ba-a9f5-4c0b488336a5
name: TMP_COVERAGE_ACTIVITY
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TGT_HL
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bdb7098a-3625-4f47-a094-771d94ce530e
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ACTIVITY_COMPANY_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6ee99029-7cf8-4f98-87ff-becad1aab586
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: EVENT_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 17cbaee2-1dd0-4512-848e-61953ed2e199
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: TIMESTAMP_TZ(9)
        description: ""
        hashDetails: null
        name: ACTIVITY_DATE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bf42535d-5e8a-4bb9-ac28-12cfbef11ce4
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ACTIVITY_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: db421018-9833-4d94-9a99-5f12307167a4
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ACTIVITY_SUBJECT
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 42fb6e15-5961-4e99-ac5e-c9920b0284b9
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ACTIVITY_INTERNAL_NOTES
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fdc08277-511a-4cc3-9e17-e2b81e2a16fb
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ACTIVITY_ATTENDEE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c03c679f-77d0-47c6-922b-fcbda39871bc
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ACTIVITY_ATTENDEE_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cac6e1e5-785a-4c82-9483-3850156a0345
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ACTIVITY_ATTENDEE_COMPANY
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a8375905-465c-4851-b3c3-e0510fb1dbce
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ACTIVITY_ATTENDEE_COMPANY_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c08d3d0c-b541-4cb7-a514-bc736847b764
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ACTIVITY_ATTENDEE_TITLE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aa8fabba-4e77-4566-99ca-7bbdb798d5ac
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: HL_ATTENDEE_NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 80cf1a5f-3dfa-482f-b898-7f8fc2ec037d
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: HL_ATTENDEE_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e55891a9-70b4-4d05-b8ba-e74c6863308c
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: HL_ATTENDEE_TITLE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 941c2d31-7db9-47e7-95ab-2677b938aa81
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: SPONSOR_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1fa7afe2-1dab-42cb-be00-407bf8001d14
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ACTIVITY_WINNING_MANDATE
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6d56988a-c573-4a8e-a312-344cd92fbf94
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: NUMBER(18,0)
        description: ""
        hashDetails: null
        name: ACTIVITY_DATE_RANK
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e7bb22f8-50e7-4750-bb17-56a3ee441089
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: NUMBER(18,0)
        description: ""
        hashDetails: null
        name: ACTIVITY_WITHIN_7DAYS
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8c2fdaaf-abcf-4c7f-906f-04f96e5d794e
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: NUMBER(18,0)
        description: ""
        hashDetails: null
        name: ACTIVITY_WITHIN_30DAYS
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d4b2cb20-9a21-4b8a-b383-5a0276a1a48d
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: NUMBER(18,0)
        description: ""
        hashDetails: null
        name: ACTIVITY_WITHIN_90DAYS
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: dabc2500-23dc-44d3-b19c-38cb4c16d05a
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: NUMBER(18,0)
        description: ""
        hashDetails: null
        name: ACTIVITY_WITHIN_180DAYS
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d35a71c2-fa0d-4120-8156-becd7fde5e32
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: NUMBER(18,0)
        description: ""
        hashDetails: null
        name: ACTIVITY_WITHIN_365DAYS
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 6d6ac817-34d6-4320-be40-f1be7b226ebb
          stepCounter: 72143244-e7c6-40ba-a9f5-4c0b488336a5
        config: {}
        dataType: NUMBER(18,0)
        description: ""
        hashDetails: null
        name: FUTURE_ACTIVITY
        nullable: true
        sourceColumnReferences:
          - columnReferences: []
            transform: ""
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('Override Create SQL') }}
            	CREATE OR REPLACE VIEW {{ ref('TGT_HL', 'TMP_COVERAGE_ACTIVITY')}} AS (
               SELECT DISTINCT Activity_Company_ID AS Activity_Company_ID
                    ,EventID AS Event_ID
                    ,Activity_Date AS Activity_Date
                    ,Activity_Type AS Activity_Type
                    ,Activity_Subject AS Activity_Subject
                    ,Activity_InternalNotes AS Activity_Internal_Notes
                    ,Activity_Attendee_ID AS Activity_Attendee_ID
                    ,Activity_Attendee_Name AS Activity_Attendee_Name
                    ,Activity_Attendee_Company AS Activity_Attendee_Company
                    ,Activity_Attendee_CompanyID AS Activity_Attendee_Company_ID
                    ,Activity_Attendee_Title AS Activity_Attendee_Title
                    ,HL_Attendee_Name AS HL_Attendee_Name
                    ,HL_Attendee_ID AS HL_Attendee_ID
                    ,HL_Attendee_Title AS HL_Attendee_Title
                    ,Sponsor_id AS Sponsor_id
                    ,WINNING_MANDATE_ATTRIBUTE_C AS Activity_Winning_Mandate
                    ,DENSE_RANK() OVER (
                        PARTITION BY a.Activity_Company_ID
                        ,HL_Attendee_ID ORDER BY a.Activity_Date DESC
                        ) AS Activity_Date_Rank --Activity_DateRank
                    ,COUNT(CASE 
                            WHEN DATEDIFF(DAY, Activity_Date, GETDATE()) <= 7
                                THEN Activity_Date
                            END) OVER (
                        PARTITION BY a.Activity_Company_ID
                        ,a.HL_Attendee_ID
                        ,a.Activity_Attendee_ID
                        ) AS ACTIVITY_WITHIN_7DAYS
                    ,COUNT(CASE 
                            WHEN DATEDIFF(DAY, Activity_Date, GETDATE()) <= 30
                                THEN Activity_Date
                            END) OVER (
                        PARTITION BY a.Activity_Company_ID
                        ,a.HL_Attendee_ID
                        ,a.Activity_Attendee_ID
                        ) AS ACTIVITY_WITHIN_30DAYS
                    ,COUNT(CASE 
                            WHEN DATEDIFF(DAY, Activity_Date, GETDATE()) <= 90
                                THEN Activity_Date
                            END) OVER (
                        PARTITION BY a.Activity_Company_ID
                        ,a.HL_Attendee_ID
                        ) AS ACTIVITY_WITHIN_90DAYS
                    ,COUNT(CASE 
                            WHEN DATEDIFF(DAY, Activity_Date, GETDATE()) <= 180
                                THEN Activity_Date
                            END) OVER (
                        PARTITION BY a.Activity_Company_ID
                        ,a.HL_Attendee_ID
                        ) AS ACTIVITY_WITHIN_180DAYS
                    ,COUNT(CASE 
                            WHEN DATEDIFF(DAY, Activity_Date, GETDATE()) <= 365
                                THEN Activity_Date
                            END) OVER (
                        PARTITION BY a.Activity_Company_ID
                        ,a.HL_Attendee_ID
                        ) AS ACTIVITY_WITHIN_365DAYS
                    ,COUNT(CASE 
                            WHEN DATEDIFF(DAY, GETDATE(), Activity_Date) > 0
                                THEN Activity_Date
                            END) OVER (
                        PARTITION BY a.Activity_Company_ID
                        ,a.HL_Attendee_ID
                        ,a.Activity_Attendee_ID
                        ) AS Future_Activity
                FROM (
                    SELECT RecentActivity.ACCOUNT_ID AS Activity_Company_ID
                        ,RecentActivity.ActivityId AS EventID
                        ,Activity.START_DATE_TIME AS Activity_Date
                        ,Activity.TYPE AS Activity_Type
                        ,Activity.SUBJECT AS Activity_Subject
                        ,TO_VARCHAR(ACTIVITY_SUPPLEMENT__C.INTERNAL_NOTES_C) AS Activity_InternalNotes
                        ,ExternalAttendee.ID AS Activity_Attendee_ID
                        ,ExternalAttendee.CONTACT_FULL_NAME_C AS Activity_Attendee_Name
                        ,ACCOUNT.NAME AS Activity_Attendee_Company
                        ,ACCOUNT.ID AS Activity_Attendee_CompanyID
                        ,ExternalAttendee.TITLE AS Activity_Attendee_Title
                        ,InternalAttendee.CONTACT_FULL_NAME_C AS HL_Attendee_Name
                        ,InternalAttendee.ID AS HL_Attendee_ID
                        ,InternalAttendee.TITLE AS HL_Attendee_Title
                        ,RecentActivity.sponsor_id AS Sponsor_id
                        ,RecentActivity.WINNING_MANDATE_ATTRIBUTE_C
                    FROM (
                        SELECT 
                            Activity.PARENT_ID_C AS ActivityId
                            ,CONTACT.ACCOUNT_ID -- opco
                            ,CONTACT.ID AS ExternalAttendeeId
                            ,Activity.WINNING_MANDATE_ATTRIBUTE_C
                            ,'' AS sponsor_id
                        FROM {{ref('TGT_HL','VW_EVENT')}} AS Activity 
                        INNER JOIN {{ref('SRC_HL','CONTACT')}} AS CONTACT 
                            ON Activity.WHO_ID = CONTACT.ID
                            AND UPPER(CONTACT.RECORD_TYPE_ID) = UPPER('012i0000000tEhjAAE')
                        WHERE Activity.PARENT_ID_C IS NOT NULL
                            AND DATEDIFF(MONTH, Activity.START_DATE_TIME, GETDATE()) <= 60
                            AND Activity.START_DATE_TIME <= GETDATE()

                        UNION

                        SELECT Activity.PARENT_ID_C AS ActivityId
                            ,Activity.WHAT_ID AS ACCOUNTID --opco
                            ,ExternalAttendee.WHO_ID AS ExternalAttendeeId
                            ,Activity.WINNING_MANDATE_ATTRIBUTE_C
                            ,contact.ACCOUNT_ID -- sponsor
                        FROM {{ref('TGT_HL','VW_EVENT')}} AS Activity 
                        INNER JOIN {{ref('TGT_HL','VW_ACCOUNT')}} AS ACCOUNT ON Activity.WHAT_ID = ACCOUNT.ID
                        LEFT JOIN {{ref('TGT_HL','VW_EVENT')}} AS ExternalAttendee 
                            ON Activity.PARENT_ID_C = ExternalAttendee.PARENT_ID_C
                        INNER JOIN {{ref('SRC_HL','CONTACT')}} CONTACT 
                            ON ExternalAttendee.WHO_ID = CONTACT.ID
                        WHERE Activity.PARENT_ID_C IS NOT NULL
                            AND DATEDIFF(MONTH, Activity.START_DATE_TIME, GETDATE()) <= 60
                            AND Activity.START_DATE_TIME <= GETDATE()
                        ) RecentActivity
                    INNER JOIN {{ref('TGT_HL','VW_EVENT')}}  AS Activity 
                        ON RecentActivity.ActivityId = Activity.ID
                    INNER JOIN {{ref('TGT_HL','VW_ACCOUNT')}}  AS ACCOUNT ON RecentActivity.ACCOUNT_ID = ACCOUNT.ID
                    LEFT JOIN {{ref('SRC_HL','CONTACT')}}  AS ExternalAttendee 
                        ON RecentActivity.ExternalAttendeeId = ExternalAttendee.ID
                    LEFT JOIN {{ref('TGT_HL','VW_ACTIVITY_SUPPLEMENT_C')}} AS ACTIVITY_SUPPLEMENT__C ON RecentActivity.ActivityId = ACTIVITY_SUPPLEMENT__C.ACTIVITY_C
                    LEFT JOIN (
                        SELECT Activity.PARENT_ID_C
                            ,CONTACT.ID
                            ,CONTACT.CONTACT_FULL_NAME_C
                            ,CONTACT.TITLE
                        FROM {{ref('TGT_HL','VW_EVENT')}}   AS Activity 
                        INNER JOIN {{ref('SRC_HL','CONTACT')}} AS CONTACT 
                            ON Activity.WHO_ID = CONTACT.ID
                            AND UPPER(CONTACT.RECORD_TYPE_ID) = UPPER('012i0000000tEheAAE')
                        WHERE Activity.PARENT_ID_C IS NOT NULL
                        ) InternalAttendee ON RecentActivity.ActivityId = InternalAttendee.PARENT_ID_C
                    INNER JOIN TMP_HLEMPLOYEE AS HLEMPLOYEE ON HLEmployee.HL_ID = InternalAttendee.ID
                    ) a
            	)
        dependencies:
          - locationName: SRC_HL
            nodeName: CONTACT
          - locationName: TGT_HL
            nodeName: VW_ACCOUNT
          - locationName: TGT_HL
            nodeName: VW_ACTIVITY_SUPPLEMENT_C
          - locationName: TGT_HL
            nodeName: VW_EVENT
        join:
          joinCondition: |-
            {{ stage('Override Create SQL') }}
            	CREATE OR REPLACE VIEW {{ ref('TGT_HL', 'TMP_COVERAGE_ACTIVITY')}} AS (
               SELECT DISTINCT Activity_Company_ID AS Activity_Company_ID
                    ,EventID AS Event_ID
                    ,Activity_Date AS Activity_Date
                    ,Activity_Type AS Activity_Type
                    ,Activity_Subject AS Activity_Subject
                    ,Activity_InternalNotes AS Activity_Internal_Notes
                    ,Activity_Attendee_ID AS Activity_Attendee_ID
                    ,Activity_Attendee_Name AS Activity_Attendee_Name
                    ,Activity_Attendee_Company AS Activity_Attendee_Company
                    ,Activity_Attendee_CompanyID AS Activity_Attendee_Company_ID
                    ,Activity_Attendee_Title AS Activity_Attendee_Title
                    ,HL_Attendee_Name AS HL_Attendee_Name
                    ,HL_Attendee_ID AS HL_Attendee_ID
                    ,HL_Attendee_Title AS HL_Attendee_Title
                    ,Sponsor_id AS Sponsor_id
                    ,WINNING_MANDATE_ATTRIBUTE_C AS Activity_Winning_Mandate
                    ,DENSE_RANK() OVER (
                        PARTITION BY a.Activity_Company_ID
                        ,HL_Attendee_ID ORDER BY a.Activity_Date DESC
                        ) AS Activity_Date_Rank --Activity_DateRank
                    ,COUNT(CASE 
                            WHEN DATEDIFF(DAY, Activity_Date, GETDATE()) <= 7
                                THEN Activity_Date
                            END) OVER (
                        PARTITION BY a.Activity_Company_ID
                        ,a.HL_Attendee_ID
                        ,a.Activity_Attendee_ID
                        ) AS ACTIVITY_WITHIN_7DAYS
                    ,COUNT(CASE 
                            WHEN DATEDIFF(DAY, Activity_Date, GETDATE()) <= 30
                                THEN Activity_Date
                            END) OVER (
                        PARTITION BY a.Activity_Company_ID
                        ,a.HL_Attendee_ID
                        ,a.Activity_Attendee_ID
                        ) AS ACTIVITY_WITHIN_30DAYS
                    ,COUNT(CASE 
                            WHEN DATEDIFF(DAY, Activity_Date, GETDATE()) <= 90
                                THEN Activity_Date
                            END) OVER (
                        PARTITION BY a.Activity_Company_ID
                        ,a.HL_Attendee_ID
                        ) AS ACTIVITY_WITHIN_90DAYS
                    ,COUNT(CASE 
                            WHEN DATEDIFF(DAY, Activity_Date, GETDATE()) <= 180
                                THEN Activity_Date
                            END) OVER (
                        PARTITION BY a.Activity_Company_ID
                        ,a.HL_Attendee_ID
                        ) AS ACTIVITY_WITHIN_180DAYS
                    ,COUNT(CASE 
                            WHEN DATEDIFF(DAY, Activity_Date, GETDATE()) <= 365
                                THEN Activity_Date
                            END) OVER (
                        PARTITION BY a.Activity_Company_ID
                        ,a.HL_Attendee_ID
                        ) AS ACTIVITY_WITHIN_365DAYS
                    ,COUNT(CASE 
                            WHEN DATEDIFF(DAY, GETDATE(), Activity_Date) > 0
                                THEN Activity_Date
                            END) OVER (
                        PARTITION BY a.Activity_Company_ID
                        ,a.HL_Attendee_ID
                        ,a.Activity_Attendee_ID
                        ) AS Future_Activity
                FROM (
                    SELECT RecentActivity.ACCOUNT_ID AS Activity_Company_ID
                        ,RecentActivity.ActivityId AS EventID
                        ,Activity.START_DATE_TIME AS Activity_Date
                        ,Activity.TYPE AS Activity_Type
                        ,Activity.SUBJECT AS Activity_Subject
                        ,TO_VARCHAR(ACTIVITY_SUPPLEMENT__C.INTERNAL_NOTES_C) AS Activity_InternalNotes
                        ,ExternalAttendee.ID AS Activity_Attendee_ID
                        ,ExternalAttendee.CONTACT_FULL_NAME_C AS Activity_Attendee_Name
                        ,ACCOUNT.NAME AS Activity_Attendee_Company
                        ,ACCOUNT.ID AS Activity_Attendee_CompanyID
                        ,ExternalAttendee.TITLE AS Activity_Attendee_Title
                        ,InternalAttendee.CONTACT_FULL_NAME_C AS HL_Attendee_Name
                        ,InternalAttendee.ID AS HL_Attendee_ID
                        ,InternalAttendee.TITLE AS HL_Attendee_Title
                        ,RecentActivity.sponsor_id AS Sponsor_id
                        ,RecentActivity.WINNING_MANDATE_ATTRIBUTE_C
                    FROM (
                        SELECT 
                            Activity.PARENT_ID_C AS ActivityId
                            ,CONTACT.ACCOUNT_ID -- opco
                            ,CONTACT.ID AS ExternalAttendeeId
                            ,Activity.WINNING_MANDATE_ATTRIBUTE_C
                            ,'' AS sponsor_id
                        FROM {{ref('TGT_HL','VW_EVENT')}} AS Activity 
                        INNER JOIN {{ref('SRC_HL','CONTACT')}} AS CONTACT 
                            ON Activity.WHO_ID = CONTACT.ID
                            AND UPPER(CONTACT.RECORD_TYPE_ID) = UPPER('012i0000000tEhjAAE')
                        WHERE Activity.PARENT_ID_C IS NOT NULL
                            AND DATEDIFF(MONTH, Activity.START_DATE_TIME, GETDATE()) <= 60
                            AND Activity.START_DATE_TIME <= GETDATE()

                        UNION

                        SELECT Activity.PARENT_ID_C AS ActivityId
                            ,Activity.WHAT_ID AS ACCOUNTID --opco
                            ,ExternalAttendee.WHO_ID AS ExternalAttendeeId
                            ,Activity.WINNING_MANDATE_ATTRIBUTE_C
                            ,contact.ACCOUNT_ID -- sponsor
                        FROM {{ref('TGT_HL','VW_EVENT')}} AS Activity 
                        INNER JOIN {{ref('TGT_HL','VW_ACCOUNT')}} AS ACCOUNT ON Activity.WHAT_ID = ACCOUNT.ID
                        LEFT JOIN {{ref('TGT_HL','VW_EVENT')}} AS ExternalAttendee 
                            ON Activity.PARENT_ID_C = ExternalAttendee.PARENT_ID_C
                        INNER JOIN {{ref('SRC_HL','CONTACT')}} CONTACT 
                            ON ExternalAttendee.WHO_ID = CONTACT.ID
                        WHERE Activity.PARENT_ID_C IS NOT NULL
                            AND DATEDIFF(MONTH, Activity.START_DATE_TIME, GETDATE()) <= 60
                            AND Activity.START_DATE_TIME <= GETDATE()
                        ) RecentActivity
                    INNER JOIN {{ref('TGT_HL','VW_EVENT')}}  AS Activity 
                        ON RecentActivity.ActivityId = Activity.ID
                    INNER JOIN {{ref('TGT_HL','VW_ACCOUNT')}}  AS ACCOUNT ON RecentActivity.ACCOUNT_ID = ACCOUNT.ID
                    LEFT JOIN {{ref('SRC_HL','CONTACT')}}  AS ExternalAttendee 
                        ON RecentActivity.ExternalAttendeeId = ExternalAttendee.ID
                    LEFT JOIN {{ref('TGT_HL','VW_ACTIVITY_SUPPLEMENT_C')}} AS ACTIVITY_SUPPLEMENT__C ON RecentActivity.ActivityId = ACTIVITY_SUPPLEMENT__C.ACTIVITY_C
                    LEFT JOIN (
                        SELECT Activity.PARENT_ID_C
                            ,CONTACT.ID
                            ,CONTACT.CONTACT_FULL_NAME_C
                            ,CONTACT.TITLE
                        FROM {{ref('TGT_HL','VW_EVENT')}}   AS Activity 
                        INNER JOIN {{ref('SRC_HL','CONTACT')}} AS CONTACT 
                            ON Activity.WHO_ID = CONTACT.ID
                            AND UPPER(CONTACT.RECORD_TYPE_ID) = UPPER('012i0000000tEheAAE')
                        WHERE Activity.PARENT_ID_C IS NOT NULL
                        ) InternalAttendee ON RecentActivity.ActivityId = InternalAttendee.PARENT_ID_C
                    INNER JOIN TMP_HLEMPLOYEE AS HLEMPLOYEE ON HLEmployee.HL_ID = InternalAttendee.ID
                    ) a
            	)
        name: TMP_COVERAGE_ACTIVITY
        noLinkRefs: []
  name: TMP_COVERAGE_ACTIVITY
  overrideSQL: true
  schema: ""
  sqlType: "154"
  type: sql
  version: 1
type: Node
