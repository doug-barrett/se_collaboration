fileVersion: 1
id: 82ca4623-c568-498e-a2e6-50dc14bf5068
name: VW_PRICING_RULES_PRODUCT
operation:
  config:
    insertStrategy: UNION
    selectDistinct: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: STAGE
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 3b1cbe16-cafb-4f77-a369-f1007b34daad
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: ZONE_GEOGRAPHY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 68fc434b-c129-42be-9890-0363078f2764
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 27b7a901-356e-4e4c-a195-d52690f0bd2d
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: PRODKEY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5e2fa667-cd1e-4c61-b6da-b56e1d1422a0
                stepCounter: 70d6c038-ab06-468f-986b-316cb67b6b5d
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b974b7ad-f978-4a7a-81e2-5779658b22a5
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: CATEGORY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 253df40d-40d6-4ed5-a83a-ca294cc57de7
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d72b49d4-6bee-4bfc-9f28-9379ae0f2815
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: SUB_CATEGORY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 875e30c6-a60d-47bf-bd68-7ef1380f1bb7
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 411f57ff-4ef4-44b5-9323-0d6e75cf12c1
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: MERCHANDISING_AREA
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 467488d8-a3aa-4f04-846e-516896242ed3
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1b0f88f7-abfc-4372-b055-84ee992c14a8
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: PLANNING_GROUP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 24baf605-d0a1-4e19-8160-7fdafc669b52
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4ab981b6-5c50-41a1-81a6-598338c0cf5a
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: BRAND
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9b049a41-20d4-47de-afe4-01fb3db6bb11
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5f87d787-889f-4891-be43-081558cf80f1
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: TACTIC_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 356be663-b617-421a-ba33-bdd8b288a37e
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 816bfff5-2a06-4e00-a5a9-03902aed4d3b
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: PRICE_ENDING_RULE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 465455cb-e561-42ce-8a03-1722ea240b36
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 09abbc14-842c-4e48-a9e5-ff56b16edb56
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: FAMILY_ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1e0aec39-cb42-4bd2-b6f2-9ef62bcb4d7e
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8325062e-0b46-478c-b2bd-c2fe6b9c8871
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: MINIMUM_MARGIN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e00b7d63-a4fa-42ae-bc4a-97bbe09f116b
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: fc9397d9-e6b3-4de8-acf9-0f7f66dcd3c2
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: TARGET_MARGIN
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a198eb18-c042-4271-aae1-a89549bc8891
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 16c7ef26-06a7-4519-875b-25e5252a051c
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: PRODUCT_STATUS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 39b2a4fa-9630-4312-985d-3807a0376140
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f8c9a11e-e64b-4d99-8558-993970ee89b6
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: MARGIN_WEIGHTING
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 67a9b164-861d-41ab-a945-3343915c6e84
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4b2cfa54-13dd-465a-8923-260bd7f56d1a
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: VOLUME_WEIGHTING
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 28c6a766-9744-4fd1-b6be-4bb71a3ff2c6
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ef07b27b-e9b6-46a4-8128-9c3666adb2a7
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: KEY_VALUE_ITEM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3048b085-20f6-4b19-b57d-bf71063653a1
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 37f069cb-cb1b-4ca2-856e-1a59fe677b2f
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: AFTER_PROMO_LAG_DAYS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 1c3ead03-ef1a-489c-b76e-7dce2365120d
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d6ab665c-60c2-49ce-891a-8c7f4b46cbfd
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: COMPETITOR_MATCH
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c73fd9c2-b2c5-4466-b3a6-66f9abc56770
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1e45f2ed-b3b6-4299-9506-0c599d746c15
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: CPI_LOW_TRIGGER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e45f5485-ba5d-4525-9619-6e2e46c13cc2
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c04de97c-fb18-4bca-8934-86f235dbacd9
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: CPI_HIGH_TRIGGER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 755326b2-3f11-4ee6-bc8d-7c8fd8504273
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bfabdc1c-ad35-4c3d-b005-142451163d0f
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: PRIMARY_COMPETITOR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0bfb2bf6-7d83-4325-a2ec-fd6af9208549
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 631b66cc-f2c3-4e1c-9a28-08476367db0a
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: PRI_COMP_LAG_DAYS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 111de130-6d23-4483-a04f-823f501bbae1
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 00c43f26-d4f2-4791-a50e-4119a6d10058
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: SECONDARY_COMPETITOR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d16d7d51-1fb9-4aa4-a85f-52c08dea87db
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: bd752684-ee1b-4dca-a940-5c600c806be8
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: SEC_COMP_LAG_DAYS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cb354bfa-22cc-4904-b6bc-1ac660275ddd
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a8db0769-fe6c-412a-b863-5766c8fc6d4b
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: TERTIARY_COMPETITOR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6a9dfb16-6650-4e05-bb1d-ccc83daa6d3e
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: da81dabe-13cc-4f2a-9a2f-ef1472f99b8f
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: TER_COMP_LAG_DAYS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 13c57697-f461-4ef1-bee5-743ce32d1eb8
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aebb9007-009a-4384-a2ce-b493186b8341
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: MARKDOWN_STEPS
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a84818d4-cb22-4ef2-b82d-dec1aef59686
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8b95eaa4-30cb-49ab-9808-d2e2f4d81e98
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: MARKDOWN_CLEAR_MAX_DISCOUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 87432950-804d-4392-8aa4-07826495a6e0
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5612241e-51cb-4fc6-ac86-f61954d9b3bd
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: LASTED_EDIDTED_BY
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0116127b-01ec-468e-a22a-ed7ace60c618
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 068426b8-e4ea-40d7-b462-79bd2787020c
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        hashDetails: null
        name: CREATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d072fd1e-7643-4f84-9cfc-aff3bc3b74c7
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ecef7e2b-1b6a-4b4e-808b-97d7095ada7c
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: TIMESTAMP
        description: ""
        hashDetails: null
        name: SYSTEM_CREATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: ccbacb6b-7eff-4222-8147-8f22e1823a77
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 41ad4088-866e-4427-bc4b-2cf1c2d1ff1e
          stepCounter: 82ca4623-c568-498e-a2e6-50dc14bf5068
        config: {}
        dataType: TIMESTAMP
        description: ""
        hashDetails: null
        name: SYSTEM_UPDATE_TIME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6e8edfed-f98c-4b25-bfff-d15ee31f1aa6
                stepCounter: 9c1562e4-92ae-4927-832e-ddf2d4d30247
            transform: ""
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          DS_PRICING_RULES: 9c1562e4-92ae-4927-832e-ddf2d4d30247
          VW_ZONE_X_PRODUCT: 70d6c038-ab06-468f-986b-316cb67b6b5d
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: DATASTORE
            nodeName: DS_PRICING_RULES
          - locationName: STAGE
            nodeName: VW_ZONE_X_PRODUCT
        join:
          joinCondition: |-
            FROM {{ ref('DATASTORE', 'DS_PRICING_RULES') }} "DS_PRICING_RULES"
            JOIN {{ ref('STAGE', 'VW_ZONE_X_PRODUCT') }} "VW_ZONE_X_PRODUCT"
            ON (
                    (
                        VW_ZONE_X_PRODUCT.ZONE_GEOGRAPHY = DS_PRICING_RULES.ZONE_GEOGRAPHY AND  VW_ZONE_X_PRODUCT.PRODKEY = DS_PRICING_RULES.PRODKEY
                    )
                    OR 
                    (
                        VW_ZONE_X_PRODUCT.ZONE_GEOGRAPHY = DS_PRICING_RULES.ZONE_GEOGRAPHY AND DS_PRICING_RULES.PRODKEY IS NULL
                        AND (VW_ZONE_X_PRODUCT.LEVEL1_DESC = DS_PRICING_RULES.CATEGORY OR DS_PRICING_RULES.CATEGORY IS NULL)
                        AND (VW_ZONE_X_PRODUCT.LEVEL2_DESC = DS_PRICING_RULES.SUB_CATEGORY OR DS_PRICING_RULES.SUB_CATEGORY IS NULL)
                        AND (VW_ZONE_X_PRODUCT.LEVEL3_DESC = DS_PRICING_RULES.MERCHANDISING_AREA OR DS_PRICING_RULES.MERCHANDISING_AREA IS NULL)
                        AND (VW_ZONE_X_PRODUCT.LEVEL4_DESC = DS_PRICING_RULES.PLANNING_GROUP OR DS_PRICING_RULES.PLANNING_GROUP IS NULL)
                        AND (VW_ZONE_X_PRODUCT.BRAND = DS_PRICING_RULES.BRAND OR DS_PRICING_RULES.BRAND IS NULL)
                    )
                )
                AND CASE WHEN UPPER(VW_ZONE_X_PRODUCT.PRODUCT_GROUP_NAME) = 'CLEARANCE' THEN 'CLEARANCE'
                        WHEN UPPER(VW_ZONE_X_PRODUCT.PRODUCT_GROUP_NAME) like 'EXIT%' THEN 'EXIT' 
                        ELSE 'CURRENT' 
                    END = 
                    CASE WHEN UPPER(DS_PRICING_RULES.TACTIC_TYPE) ='CLEARANCE' THEN 'CLEARANCE'
                        WHEN UPPER(DS_PRICING_RULES.TACTIC_TYPE) like 'EXIT%' THEN 'EXIT'
                        ELSE 'CURRENT'
                    END 
            QUALIFY 1 = ROW_NUMBER() OVER ( PARTITION BY VW_ZONE_X_PRODUCT.ZONE_GEOGRAPHY, VW_ZONE_X_PRODUCT.PRODKEY
                                            ORDER BY 
                                                CASE WHEN DS_PRICING_RULES.PRODKEY IS NOT NULL THEN 1
                                                WHEN DS_PRICING_RULES.PLANNING_GROUP IS NOT NULL  AND DS_PRICING_RULES.BRAND IS NOT NULL   THEN 2
                                                WHEN DS_PRICING_RULES.MERCHANDISING_AREA IS NOT NULL  AND DS_PRICING_RULES.brand IS NOT NULL   THEN 3
                                                WHEN DS_PRICING_RULES.SUB_CATEGORY IS NOT NULL  AND DS_PRICING_RULES.brand IS NOT NULL   THEN 4
                                                WHEN DS_PRICING_RULES.CATEGORY IS NOT NULL AND DS_PRICING_RULES.brand IS NOT NULL   THEN 5
                                                WHEN DS_PRICING_RULES.PLANNING_GROUP IS NOT NULL  THEN 6
                                                WHEN DS_PRICING_RULES.MERCHANDISING_AREA IS NOT NULL  THEN 7
                                                WHEN DS_PRICING_RULES.SUB_CATEGORY IS NOT NULL  THEN 8
                                                WHEN DS_PRICING_RULES.CATEGORY IS NOT NULL  THEN 9
                                                ELSE 10 
                                                END)
        name: VW_PRICING_RULES_PRODUCT
        noLinkRefs: []
  name: VW_PRICING_RULES_PRODUCT
  overrideSQL: false
  schema: ""
  sqlType: "16"
  type: sql
  version: 1
type: Node
